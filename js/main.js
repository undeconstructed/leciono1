
const translations = {
  "eo": {
    "title": "Esperanto en 17 minutoj",
    "01": "(Äˆi tio ne estas Esperanto-kurso, sed Äi donu al vi ideon pri kio la lingvo estas, kaj vi verÅajne povus lerni la plimulton de tio kion vi bezonas per Ä‰i tio, kaj per iom da legado.)",
    "02": "Esperanto estas aro da vortradikoj, kaj sistemo por aranÄi ilin por ke oni povu uzi ilin por krei ion pli grandan. Ni komencu.",
    "03": "Rigardu tra la fenestro. VerÅajne pluvas. La radiko por tio estas <em>pluv-</em>.",
    "04": "Pluvo estas kialo por paroli. Por diri ke pluvas, prenu la radiko \"pluv-\", kaj verbigu Äin, per aldono de la finaÄµo kiu signifas \"okazas nun\": <em>-as</em>.",
    "e01": "pluvas.",
    "05": "Tio estas frazo. Oni konstruas frazon Ä‰irkaÅ­ verbo - tiu verbo enhavas la kialon por fari la frazon, kaj marko kiu diras kiam tiu afero okazas. Estas kvin finaÄµoj:",
    "verb-is": "okazis en la pasinteco",
    "verb-as": "okazas nun",
    "verb-os": "verÅajne okazos iam en la estonteco",
    "verb-us": "okazas en imaga mondo",
    "verb-u": "iu volas, ke Äi okazu",
    "06": "Kelkfoje, oni volas diri kiu aÅ­ kio faras la verbon. Tio estas tre facila - prenu la radiko de tiu afero, kaj substantivigu Äin per la <em>-o</em> finaÄµo.",
    "e02": "kato kuris",
    "07": "Se oni volas uzi alian koncepton por priskribi substantivon, prenu la radikon por tiu koncepto, kaj aldonu <em>-a</em> por fari Äin adverbo:",
    "e03": "blua kato dormos.",
    "08": "Eble estas alia koncepto kiu iel rilatas al Ä‰i tiu ago. Eble estas loko, en kiu Äi okazas. Por aldoni alian substantivon, oni povas enkonduki Äin per prepozicion, por diri kiel Äi rilatas al la ago.",
    "e04": "blua kato sidas antaÅ­ televidilo (ilo-por-televidi).",
    "09": "Kelkfoje ne estas evidente elektinda prepozicio, aÅ­ vi nur ne volas uzi Äin. Tiaokaze vi povas marki la substantivon (kaj Äiajn adjektivojn) per <em>-n</em> finaÄµo, por diri \"vi scias pri kio estas Ä‰i tiu afero\".",
    "e05": "kateto ne Åatas pluvegon.",
    "10": "Parenteze, Ä‰ar Ä‰io estas nete markita, oni povas iom reaordigi la vortojn:",
    "e06": "pluvon malvarman (malo-de-varma) kato malamas (malo-de-amas).",
    "11": "Sed ne tro faru tion, nur uzi Äin kiam Äi plifaciligas komprenon de la frazo.",
    "12": "Estas nur unu plia speco de verbo por lerni: adverboj. Mi ne scias precize kio estas adverbo, sed Äi finiÄas per <em>-e</em> kaj oni uzas Äin por priskribi ion ajn kiu ne estas substantivo. Ili estas tre flekseblaj (eble dangere!), sed komencu per meti ilin antaÅ­ la vorto kiun ili priskribas, kaj vi baldaÅ­ komprenos la ideon:",
    "e07": "la subite malseka (malo-de-seka) kato rapide enkuras (en-kuras).",
    "13": "Foje oni devas esti pli precize ol nur \"kato\" - oni dfevas diri kiu kato. La plej facila eblo estas uzi <em>la</em>, kiu surbaze signifas \"vi scias kiun.\"",
    "e08": "la kato manÄas manÄaÄµojn (aÄµon-por-manÄi).",
    "14": "AÅ­ eble oni pli volas diri \"tiu, pri kiu ni parolas\":",
    "e09": "tiu kato Ä‰asus hundojn.",
    "15": "Se oni volas rilatigi kelkajn frazojn, oni bezonas vortojn por fari tion. Oni Ä‰iam havos unu Ä‰efan frazon, kiel antaÅ­e, sed rilataj frazoj bezonos enkondukon, ekzemple:",
    "e10": "tiu kato Ä‰asus hundojn, se Äi trovus hundojn.",
    "e11": "tiu kato malÅatas hundojn, Ä‰ar ili estas bruaj.",
    "16": "Dum ni tiel emas, ni faru Ä‰iujn el la pronomoj:",
    "mi": "la ulo kiu parolas",
    "ni": "la parolanto kaj ties kunuloj",
    "vi": "al kiu, tiu ulo parolas",
    "gxi": "alia aÄµo",
    "li": "alia iÄ‰a ulo",
    "sxi": "alia ina ulo",
    "ili": "plruaj aliaj aÄµoj aÅ­ uloj",
    "oni": "simple, iu",
    "17": "\"Sed\", vi demandas, \"kio pri seks-neÅ­traleco?\". Nu, ni revenos al tiu temo, poste.",
    "18": "Okej, nun venas malfacila parto. Äˆu vi estas preta? Kelkfoje oni volas ligi frazojn laÅ­ speciala maniero, kie oni prenas ideon de unu frazo kaj iel metas Äin en la alian. Por tio, oni uzas la vorton <em>kiu</em>, kiu estas kiel <em>tiu</em>, sed estas speciale por citi ideon en nova frazo:",
    "e12": "la kato, kiu Ä‰asas hundojn, estas feliÄ‰a.",
    "19": "Hm, Ä‰u estas sufiÄ‰e klare, ke la \"kiu\" estas pri la kato? Jes, verÅajne, sed ni povas esti pli klara:",
    "e13": "la kato, kiu kato estas granda, estas dormema (ema-al-dormo).",
    "20": "Fakte, oni povas preni iun ajn ideojn el la Ä‰efa frazo, kaj meti Äin en subfrazon, ni nur devas diri kian aferon Äi estas:",
    "e14": "mi faris tion je la oka horo, je kiu tempo mi ridis.",
    "21": "Fakte, ekzistas kelkaj faciligoj kiujn oni povas uzi por Ä‰i tiaj aferoj:",
    "e15": "mi estas kontenta, kiam mi estas kun vi.",
    "22": "Ni parolas pri Ä‰iuj el tiaj vortoj iam poste, sed por nun jen nur unu plian: Foje oni simple volas paroli pri .. io. Ne estas klare, kia afero Äi estas tiu afero, Äi simple estas io. Ni provu tion:",
    "e16": "kio estas tio? tio estas kato.",
    "23": "Ho, jes, ankaÅ­ tiuj <em>ki-</em> vortoj estas bonaj por demandoj. Pensu ke ili signifas \"metu la taÅ­gan aferon Ä‰i tien, mi petas\". AnkaÅ­ ekzistas simplan rimedon por starigi jes/ne demandon:",
    "e17": "Ä‰u vi komprenas? jes .. kaj ne.",
    "24": "Bone. Estas nur unu plua afero por diskuti. Ni komencos facile, kaj poste iÄu freneza kun Äi. Se oni volas priskribi ion dufoje, ekzemple per speco kaj per nomo, simple metu ilin ambaÅ­ kune:",
    "e18": "mia amiko Tomaso estas tie.",
    "25": "Sed, kion fari se oni ne povas trovi vorton por io? Nu, oni devus uzi frazon. Pensu, ke la frazo prenas la lokon de nomo: Äi estas sufiÄ‰e da informo por komuniki ideon, sed per pluraj vortoj. Ni provu:",
    "e19": "mi Åatas la ideon ke katoj povu flugi.",
    "26": "\"la ideon\" (la ideo) ne estas sufiÄ‰e da informo, Ä‰ar Äi ne diris kio estas la ideo, do ne aldonas frazon kiu diras kio estas la ideo. La eta vorto <em>ke</em> nur diras \"jen frazo\". Estas multo kiun oni povas fari per Ä‰i tio, do ni provu unu-du aferojn:",
    "e20": "mi estas kontenta, pro tio ke vi estas Ä‰i tie.",
    "27": "La vorto \"tio\" signifas \"tiu afero\", sed kiu afero?! Äœi ne diras!! Nu, tial ni aldonis frazon por klarigi. Fakte, la \"tio\" ne estas tre interesa, ni eble povus forlasi Äin. Simile, ni eble ne bezonas la \"pro\" - oni divenus ke Ä‰i tio estas pri la kaÅ­zo de io, Ä‰u ne? Eble ni povus nur diri:",
    "e21": "mi estas kontenta ke vi estas Ä‰i tie.",
    "28": "Sed memoru! Ju pli da vortoj oni forÄµetas, des pli la risko ke Ä‰io eksplodos!",
    "29": "Dum ni parolas pri forÄµeti vortojn, estas alia speco de verba afero, kiu ne vere estas verbo. Se vorto finiÄas per <em>-i</em>, Äi estas speco de Äenerala ideo de verbo. La evento ne okazas, Äi simple iel ekzistas, kaj indikas ke kompleta frazo ekzistas, nedirate. Sed provu priprensi Ä‰u iu povus miskompreni.",
    "e22": "la kato volas dormi.",
    "30": "Kaj finfine estas kelkaj afero kiujn mi ne volas klarigi nun. Ili certe estos iom konfuzaj, kaj ofte temas pri la tre utilaj radikoj <em>ig</em> kaj <em>iÄ</em>.",
    "e23": "tio interesas min. mi interesiÄas.",
    "e24": "la kato bluiÄis, Ä‰ar mi bluigis Äin.",
    "31": "Kaj, ankaÅ­ estas participoj, kiuj permesas ke oni uzi agaj konceptoj por priskribi aferoj, ekzemple por diri ke io estas farata. Estas 6 participoj, sed ili sekvas bonan skemon, do vi komprenos. VerÅajne.",
    "e25": "mi estus farinta tion. mi estos faranta tion. finfine, tio estos farita.",
    "e26": "trovinte la hundon, mi estas serÄ‰onta la katon.",
    "32": "Ho, atendu, mi promesis paroli pri tiuj ki- kaj ti- kaj neni- vortoj, kaj mi jam ne faris tion. Fakte mi eÄ‰ neniam menciis neni- antaÅ­ nun. Bone, jen la komencoj kaj finoj de kelkaj vortoj, simple kunmeti ilin:",
    "tabelti": "tiu",
    "tabelki": "kiu",
    "tabeli": "iu",
    "tabelneni": "neniu",
    "tabelcxi": "Ä‰iu",
    "tabelo": "afero (Ä‰i tiu estas substantivo)",
    "tabelu": "individuo (Ä‰i tiu estas speco de adjektivo)",
    "tabela": "speco (ankaÅ­ adjektivo)",
    "tabeles": "de individuo (denove, adjektivo)",
    "tabelel": "maniero (Ä‰i tiu estas adverbo)",
    "tabele": "loko (kaj tiel estas la cetero, pli-malpli)",
    "tabelam": "tempop/kiamo",
    "tabelal": "kialo",
    "tabelom": "kvanto/kiomo",
    "33": "Iel mi forgesis pri kelkaj bazaj vortoj, do ni rigardu kelkajn pluajn frazojn:",
    "e27": "vi, kaj mi, kaj la kato, estas Ä‰i tie, sed la hundo mankas.",
    "e28": "nun, la kato bojas kiel hundo. aÅ­ eble tio estas la hundo.",
    "e29": "la lingvo estas facile lernebla, kaj lerninda, kaj baldaÅ­ estos lernita.",
    "34": "Jes. Tio sufiÄ‰os.",
    "end": "Kaj, kio nun? Lernu, uzu, Äuu! Estas retaj kursoj Ä‰e <a href=\"https://lernu.net\">lernu.net</a>, kaj Ä‰e <a href=\"https://www.duolingo.com/\">Duolingo</a>, aÅ­ Ä‰e <a href=\"https://learn.esperanto.com/\">Esperanto en 12 tagoj</a>. AÅ­ eÄ‰ pli bone, aliÄu al kurso instruata de <a href=\"https://londonaesperantoklubo.com/OnlineEsperantoCourses.html\">La Londona Esperanto-Klubo</a>."
  },
  "se": {
    "title": "Esperanto pÃ¥ 17 minuter"
  },
  "pl": {
    "title": "Esperanto w 17 minut"
  },
  "fr": {
    "title": "EspÃ©ranto en 17 minuits"
  },
  "de": {
    "title": "Esperanto in 17 minuten"
  },
  "es": {
    "title": "Esperanto en 17 minutos"
  }
}

function translate(lang) {
  let baseText = translations['en']

  let text = translations[lang]
  if (!text) {
    // don't have appropriate translation
    return
  }

  for (let e of document.querySelectorAll('.learn')) {
    let id = e.getAttribute('tid')
    e.innerHTML = text[id] || baseText[id]
  }

  document.querySelector('.languagechooser select').value = lang
}

function flag(code) {
  if (code == 'eo') {
    // let f = document.createElement('div')
    // f.classList.add('eoflag')
    return 'Eo'
  }
  if (code == 'en') {
    code = 'gb'
  }

  const aL = 'a'.codePointAt(0)
  const aF = 'ğŸ‡¦'.codePointAt(0)

  let out = ''
  for (let l of code) {
    let c = l.codePointAt(0)
    let o = aF + (c - aL)
    out += String.fromCodePoint(o)
  }

  return out
}

function setupLanguageChooser() {
  let chooser = document.querySelector('.languagechooser')
  let select = chooser.querySelector('select')
  for (let lang of Object.keys(translations).sort()) {
    let opt = document.createElement('option')
    opt.value = lang
    opt.append(flag(lang))
    select.append(opt)
  }
  select.addEventListener('change', _e => {
    let lang = select.value
    translate(lang)
  })
}

function setupAudio(e) {
  let id = e.getAttribute('fid')
  let eAudio = document.createElement('audio')
  eAudio.src = `sound/e${id}.mp3`
  e.append(eAudio)
  e.addEventListener('click', _e => {
    eAudio.play()
  })
  eAudio.addEventListener('play', _e => {
    e.classList.add('playing')
  })
  eAudio.addEventListener('ended', _e => {
    e.classList.remove('playing')
  })
  e.append('ğŸ”‰\ufe0e')
}

function main() {
  let en = {}
  for (let e of document.querySelectorAll('.learn')) {
    let id = e.getAttribute('tid')
    en[id] = e.innerHTML
    translations['en'] = en
  }
  console.log(JSON.stringify(en, '', '  '))

  setupLanguageChooser()

  let firstLang = navigator.language.split('-')[0]
  translate(firstLang)

  for (let e of document.querySelectorAll('.listen')) {
    setupAudio(e)
  }
}

document.addEventListener('DOMContentLoaded', main)
